<!DOCTYPE html>
<html lang="ru">
<head>
	<title>JS LIB</title>
	<meta charset="windows-1251" />
	
	<script src="http://code.jquery.com/jquery-latest.js"></script>
  <script type="text/javascript" src="jQuery.js"></script>
  <script src="jquery.transit.min.js"></script>
  <script src="jquery.scrollTo-1.4.3.1-min.js"></script>
	
<style>
html {
  margin: 0px;
  padding: 0px;
}
body {
  margin: 0px;
  padding: 0px;
  background-color: #111;
  font-family: monospace;
  font-size: 10pt;
  color: #fff;
}

div[contenteditable="true"]:focus {
  outline: none;
}

.right {
  float: right;
}
.hidden {
  display: none;
}


</style>

<script>

$(document).ready(function () {

  function list_to_string(list) {
    var string = "";
    for (var l=0; l<list.length; l++) {
      string = string + list[l];
    };
    return string;
  };

  function data() {
    this.toRepr = function() {
      alert(JSON.stringify(this));
    };
  };

  function repr() {
    this.toData = function() {
      alert(JSON.stringify(this));
    };
  };

  function new_block(type, info, prop, inner) {
    if (type == 'data') {
      var block = new data();
    } else if (type == 'repr') {
      var block = new repr();
    };
    block['dict'] = true;
    block['type'] = type;
    block['info'] = info;
    block['prop'] = prop;
    block['inner'] = inner;
    return block;
  };

  function HTMLtag(keyword, attrs) {
    var info = {
      'lang' : 'HTML',
      'exp' : 'tag',
    };
    var prop = {
      'keyword' : keyword,
      'attrs' : attrs,
    };
    var inner = {

    };
    var tag = new_block('repr', info, prop, inner);
    return tag;
  };

  function parser() {
    var code = $("#input").text();

    code = code.replace(/>/g, '>%???%').replace(/</g, '%???%<').split('%???%');

    for (var i=0; i<code.length; i++) {
      if (code[i].substr(0,1) == '<') {
        if (code[i].substr(0,2) == '</') {
          code[i] = {
            'type' : 'close_tag',
            'value' : code[i].substr(2,code[i].length-1-2),
          };
        } else {
          code[i] = {
            'type' : 'open_tag',
            'value' : code[i].substr(1,code[i].length-1-1),
          };
        };
      } else {
        code[i] = {
          'type' : 'inner_text',
          'value' : code[i],
        };
      };
    };

    var tree = [];
    for (var i=0; i<code.length; i++) {
      if (code[i]['value'] != "") {
        tree.push(code[i]);
      };
    };

    var lvl = 0;
    for (var i=0; i<tree.length; i++) {
      if (tree[i]['type'] == 'open_tag') {
        tree[i]['level'] = lvl;
        lvl = lvl + 1;
      } else if (tree[i]['type'] == 'close_tag') {
        lvl = lvl - 1;
        tree[i]['level'] = lvl;
      } else if (tree[i]['type'] == 'inline_tag') {
        tree[i]['level'] = lvl;
      } else if (tree[i]['type'] == 'inner_text') {
        tree[i]['level'] = lvl;
      };
    };

    var repr = [];

    for (var i=0; i<tree.length; i++) {
      if (tree[i]['type'] == 'open_tag') {
        if (tree[i]['level'] == 0) {
          repr.push(HTMLtag(tree[i]['value'], ""));
        } else {
          //From here
        };
      };
    };

    alert(JSON.stringify(tree));
  };

  //var a = HTMLtag('div', {'class':'testclass'});
  //a.toData();

  $(document).on('click','#go', function(){
    parser();
  });

  //Examples
    var abstract = [
      {
        'dict' : true, //Required. If it is a dictionary
        'type' : 'repr', //Required. Valid values: 'data', 'repr'
        'info' : { //Required. Includes user properties
          //....
        },
        'prop' : { //Required. Includes user properties
          //....
        },
        'inner' : [ //Required. Includes a number of dictionaries
          //....
        ],
      },
    ];

    var some_syntax = [
      {
        'dict' : true, //Required. If it is a dictionary
        'type' : 'repr', //Required. Valid values: 'data', 'repr'
        'info' : { //Required. Includes user properties
          //User
          'lang' : 'HTML',
          'exp' : 'tag',
        },
        'prop' : { //Required. Includes user properties
          //User
          'keyword' : 'div',
          'attrs' : [

          ],
        },
        'inner' : [ //Required. Includes a number of dictionaries
          //....
        ],
      },
    ];

    var data_example = [
      {
        'dict' : true, //Required. If it is a dictionary
        'type' : 'data', //Required. Valid values: 'data', 'repr'
        'info' : { //Required. Includes user properties
          //User
          'descr' : 'status list',
        },
        'prop' : { //Required. Includes user properties
          //User
          'display' : 'radio',
        },
        'inner' : [ //Required. Includes a number of dictionaries
          //User
          'status1',
          'status2',
          //...etc
        ],
      },
    ];

});

</script>

</head>
	
<body>

<div id="input" style="margin: 20px; padding:5px; width: 300px; height: 200px; background:#222;" contenteditable="true"></div>

<div id="go" style="margin: 20px; width: 200px; height: 40px; background:#222;"></div>

<div id="output" style="margin: 20px; padding:5px; width: 300px; min-height: 200px; background:#222;"></div>


</body>
</html>